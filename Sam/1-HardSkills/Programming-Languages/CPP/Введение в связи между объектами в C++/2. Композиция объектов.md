# Композиция объектов
Процесс построения сложных объектов из более простых называется **композицией объекта**.

## Типы композиции объектов
В композиции между двумя объектами представлен [**тип отношения**](https://ravesli.com/urok-146-otnosheniya-mezhdu-obektami/) «имеет». Автомобиль «имеет» коробку передач. Ваш компьютер «имеет» центральный процессор. Вы «имеете» сердце. Сложный объект иногда называют **целым** (или _**«родителем»**_). Более простой объект часто называют **частью** (или _**«дочерним элементом»**_, _**«компонентом»**_).

Ранее мы рассматривали, что [**структуры**](https://ravesli.com/urok-61-struktury/) и [**классы**](https://ravesli.com/urok-113-klassy-obekty-i-metody-klassov/) могут иметь члены разных типов данных (например, фундаментальных или вообще других классов). Когда мы создаем классы с членами, то мы, по сути, создаем сложный объект из более простых частей, что и является композицией объекта. По этой причине структуры и классы еще называют **составными типами данных**.

Композиция объектов полезна в контексте языка C++, поскольку позволяет создавать сложные классы, объединяя более простые и легко управляемые части. Это уменьшает сложность и позволяет писать код быстрее и с меньшим количеством ошибок, так как мы можем повторно использовать код, который уже был написан, протестирован, и является рабочим.

Существует два основных подтипа композиции объекта: **композиция** и **агрегация**. На этом уроке мы рассмотрим композицию, а на следующем — агрегацию.

**Для реализации композиции объект и часть должны иметь следующие отношения:**
   - Часть (член) является частью объекта (класса).
   - Часть (член) может принадлежать только одному объекту (классу) в моменте.
   - Часть (член) существует, управляемая объектом (классом).
   - Часть (член) не знает о существовании объекта (класса).
  
Хорошим примером композиции в жизни является взаимосвязь между телом человека и его сердцем. Рассмотрим это детально.

Отношения в композиции — это отношения части-целого. Например, сердце является частью тела человека. Часть в композиции может быть частью только одного объекта в моменте. Сердце, которое является частью тела одного человека, не может быть одновременно частью тела еще одного человека.

В отношениях внутри композиции объект несет ответственность за существование частей. Чаще всего это означает, что часть создается при создании объекта и уничтожается при его уничтожении. Но в более широком смысле это означает, что объект управляет временем жизни части таким образом, что пользователь, который использует объект, не должен участвовать в этом. Например, при создании тела создается и сердце. Когда тело человека уничтожается, то и его сердце уничтожается тоже.

И, наконец, часть не знает о существовании целого. Ваше сердце работает круглосуточно, не зная, что оно является частью более крупной организации. Это называется однонаправленным отношением, поскольку тело знает о сердце, а сердце о теле — нет.

 Композиция часто используется для моделирования физических отношений, где один объект физически находится внутри другого объекта.

Части в композиции могут быть как сингулярными (единственными в своем роде), так и мультипликативными (таких частей может быть несколько). Например, в теле человека есть только одно сердце (сердце является сингулярным), но также 20 пальцев (пальцы являются мультипликативными и могут быть реализованы в виде [**массива**](https://ravesli.com/urok-74-massivy-chast-1/)).

## Вариации композиции

Хотя в большинстве композиций создание/удаление частей происходит непосредственно при создании/удалении самой композиции, есть вариации композиции, где правила несколько видоизменены, например:

- Композиция может отложить создание некоторых из своих частей до тех пор, пока они не понадобятся. Например, строковый класс может не создавать динамический массив символов до тех пор, пока пользователь не предоставит данные, которые эта строка могла бы хранить.

- Композиция может предпочесть использовать часть, которая была предоставлена ей в качестве входных данных, а не создавать эту часть самостоятельно.

- Композиция может делегировать уничтожение своих частей другому объекту (например, процедуре сбора мусора).

Ключевым моментом является то, что композиция должна управлять своими частями самостоятельно, без вмешательства пользователя композиции.